<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>å“ç‰Œï¼ç”¢å“è³‡æ–™æäº¤ï½œLIFF</title>
  <meta name="theme-color" content="#111827">
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    :root { --bg:#0b1220; --card:#0f172a; --muted:#94a3b8; --text:#e5e7eb; --accent:#22c55e; --accent2:#3b82f6; --danger:#ef4444; }
    *{box-sizing:border-box} body{margin:0;background:linear-gradient(180deg,#0b1220,#0b1220 60%,#101826);color:var(--text);
      font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial}
    .wrap{max-width:720px;margin:0 auto;padding:28px}
    .card{background:var(--card);border:1px solid #1f2937;border-radius:18px;padding:22px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    h1{margin:0 0 14px;font-size:22px;letter-spacing:.3px}
    p.lead{margin:0 0 18px;color:var(--muted);font-size:14px}
    .grid{display:grid;grid-template-columns:1fr;gap:14px}
    @media(min-width:720px){.grid-2{grid-template-columns:1fr 1fr}}
    label{font-size:13px;color:#cbd5e1;margin-bottom:6px;display:block}
    input,textarea,select{
      width:100%;background:#0b1220;border:1px solid #263043;color:#e5e7eb;border-radius:12px;
      padding:12px 14px;font-size:14px;outline:none;transition:.2s border,.2s box-shadow
    }
    input:focus,textarea:focus,select:focus{border-color:#334155;box-shadow:0 0 0 3px rgba(59,130,246,.15)}
    textarea{min-height:120px;resize:vertical}
    .row{display:grid;gap:10px}
    .row-2{grid-template-columns:1fr 1fr}
    .muted{color:var(--muted);font-size:12px}
    .btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:6px}
    button{
      border:0;border-radius:12px;padding:12px 16px;font-size:14px;cursor:pointer;
      background:#1f2937;color:#e5e7eb;transition:.2s transform,.2s background
    }
    button:active{transform:translateY(1px)}
    .primary{background:var(--accent2)}
    .primary:hover{filter:brightness(1.05)}
    .success{background:var(--accent)}
    .danger{background:var(--danger)}
    .pill{display:inline-flex;align-items:center;gap:8px;background:#0b1220;border:1px solid #1f2a44;color:#9fb2cc;
      padding:8px 12px;border-radius:999px;font-size:12px}
    .divider{height:1px;background:#1f2937;margin:14px 0}
    .hide{display:none}
    .footer{color:#64748b;font-size:12px;text-align:center;margin-top:18px}
    .tag{display:inline-block;background:#0b1220;border:1px solid #2a364e;color:#a5b4fc;border-radius:999px;padding:6px 10px;font-size:12px}
    .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .profile{display:flex;align-items:center;gap:10px}
    .avatar{width:36px;height:36px;border-radius:50%;background:#111826;border:1px solid #263043;object-fit:cover}
    .status{font-size:12px;color:#9ca3af}
    .success-view{display:flex;flex-direction:column;align-items:center;gap:10px;text-align:center;padding:30px}
    .success-view h2{margin:0}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="topbar">
        <div>
          <h1>å“ç‰Œï¼ç”¢å“è³‡æ–™æäº¤</h1>
          <p class="lead">æ­¤é é¢ä½¿ç”¨ LINE Front-end Frameworkï¼ˆLIFFï¼‰ã€‚é€å‡ºå¾Œå¯å›å‚³åˆ° LINE å°è©±ï¼Œæˆ– POST åˆ°ä½ çš„ Webhookï¼ˆä¾‹å¦‚ n8nï¼‰ã€‚</p>
        </div>
        <div class="profile">
          <img id="avatar" class="avatar" alt="">
          <div>
            <div id="displayName" class="status">å°šæœªç™»å…¥</div>
            <div id="uid" class="muted"></div>
          </div>
        </div>
      </div>

      <div class="pill">ç‹€æ…‹ï¼š<span id="liffStatus">åˆå§‹åŒ–ä¸­...</span></div>
      <div class="divider"></div>

      <form id="productForm" novalidate>
        <div class="grid grid-2">
          <div>
            <label for="brandName">å“ç‰Œåç¨± <span class="muted">ï¼ˆå¿…å¡«ï¼‰</span></label>
            <input id="brandName" name="brandName" placeholder="ä¾‹ï¼šå·±æ–‡å ‚ Jiwen Tang" required />
          </div>
          <div>
            <label for="brandWebsite">å“ç‰Œå®˜ç¶² / é€£çµ</label>
            <input id="brandWebsite" name="brandWebsite" placeholder="https://example.com" />
          </div>
        </div>

        <div class="grid">
          <div>
            <label for="productName">ç”¢å“åç¨± <span class="muted">ï¼ˆå¿…å¡«ï¼‰</span></label>
            <input id="productName" name="productName" placeholder="ä¾‹ï¼šäº”è¡Œå®ˆè­·é¦™ï¼ˆæœ¨æ°£é¦™ï¼‰" required />
          </div>

          <div class="row row-2">
            <div>
              <label for="category">åˆ†é¡</label>
              <select id="category" name="category">
                <option value="">â€” è«‹é¸æ“‡ â€”</option>
                <option>é¦™æ°› / ç·šé¦™</option>
                <option>å±…å®¶ç”Ÿæ´»</option>
                <option>ä¿å¥ï¼é£Ÿå“</option>
                <option>ç¾å¦å€‹æ¸…</option>
                <option>å…¶ä»–</option>
              </select>
            </div>
            <div>
              <label for="price">å”®åƒ¹ï¼ˆæ•¸å­—ï¼‰</label>
              <input id="price" name="price" type="number" inputmode="decimal" placeholder="2980" min="0" step="0.01" />
            </div>
          </div>

          <div class="row row-2">
            <div>
              <label for="sku">SKU / ç”¢å“ä»£ç¢¼</label>
              <input id="sku" name="sku" placeholder="ä¾‹ï¼šJWT-WOOD-001" />
            </div>
            <div>
              <label for="launchDate">ä¸Šå¸‚æ—¥æœŸ</label>
              <input id="launchDate" name="launchDate" type="date" />
            </div>
          </div>

          <div>
            <label for="imageUrl">ç”¢å“ä¸»åœ– URL</label>
            <input id="imageUrl" name="imageUrl" placeholder="https://example.com/image.jpg" />
          </div>

          <div>
            <label for="desc">ç”¢å“æè¿° / å–é» <span class="muted">ï¼ˆå¿…å¡«ï¼›æ”¯æ´å¤šè¡Œï¼‰</span></label>
            <textarea id="desc" name="desc" placeholder="ä¾‹ï¼šçµåˆå§“åå­¸ Ã— äº”è¡Œç†è«–ï¼Œè£œè¶³èƒ½é‡ã€æå‡å„€å¼æ„Ÿ..." required></textarea>
          </div>

          <div class="row row-2">
            <div>
              <label for="contact">è¯çµ¡ Email</label>
              <input id="contact" name="contact" type="email" placeholder="you@example.com" />
            </div>
            <div>
              <label for="notes">å‚™è¨»</label>
              <input id="notes" name="notes" placeholder="å…¶ä»–è£œå……" />
            </div>
          </div>
        </div>

        <div class="divider"></div>
        <div class="btns">
          <button type="button" class="primary" id="sendToLineBtn">é€å› LINE å°è©±</button>
          <button type="submit" class="success">POST åˆ° Webhook</button>
          <button type="button" class="danger" id="resetBtn">æ¸…é™¤è¡¨å–®</button>
          <span class="tag">Webhookï¼š<code id="whLabel">æœªè¨­å®š</code></span>
        </div>
        <p class="muted">æç¤ºï¼šä½ å¯ä»¥åªç”¨å…¶ä¸­ä¸€ç¨®æäº¤æ–¹å¼ï¼›æœªè¨­å®š Webhook ä¹Ÿèƒ½é€å› LINE å°è©±ã€‚</p>
      </form>

      <div id="successView" class="success-view hide">
        <h2>âœ… å·²æäº¤å®Œæˆï¼</h2>
        <p class="muted">ä½ å¯ä»¥é—œé–‰æ­¤é é¢ï¼Œæˆ–ç¹¼çºŒæäº¤ä¸‹ä¸€ç­†è³‡æ–™ã€‚</p>
        <div class="btns">
          <button id="newEntryBtn">æ–°å¢ä¸‹ä¸€ç­†</button>
          <button id="closeBtn">é—œé–‰æ­¤é </button>
        </div>
      </div>
    </div>

    <div class="footer">
      Â© <span id="year"></span> LIFF Demo Â· å»ºè­°å°‡æ­¤é è¨»å†Šç‚º LIFF Endpointï¼š<br/>
      <code>https://&lt;ä½ çš„ GitHub ç”¨æˆ¶å&gt;.github.io/&lt;ä½ çš„ Repo&gt;/index.html</code>
    </div>
  </div>

  <script>
    // ======= 1) åŸºæœ¬è¨­å®šï¼šè«‹æ›¿æ›ç‚ºä½ çš„ LIFF èˆ‡ Webhook =======
    const LIFF_ID = "YOUR_LIFF_ID_HERE"; // â† å¿…å¡«ï¼šæ›æˆä½ çš„ LIFF ID
    const WEBHOOK_URL = "";              // â† é¸å¡«ï¼šä¾‹å¦‚ä½ çš„ n8n Webhook URL
    // ================================================

    // UI åƒè€ƒ
    const liffStatus = document.getElementById("liffStatus");
    const whLabel = document.getElementById("whLabel");
    const avatar = document.getElementById("avatar");
    const displayNameEl = document.getElementById("displayName");
    const uidEl = document.getElementById("uid");
    const form = document.getElementById("productForm");
    const sendToLineBtn = document.getElementById("sendToLineBtn");
    const resetBtn = document.getElementById("resetBtn");
    const successView = document.getElementById("successView");
    const newEntryBtn = document.getElementById("newEntryBtn");
    const closeBtn = document.getElementById("closeBtn");

    document.getElementById("year").textContent = new Date().getFullYear();
    whLabel.textContent = WEBHOOK_URL ? "å·²è¨­å®š" : "æœªè¨­å®š";

    // å°‡è¡¨å–®è½‰ç‰©ä»¶
    function getFormData() {
      const data = {
        brandName: document.getElementById("brandName").value.trim(),
        brandWebsite: document.getElementById("brandWebsite").value.trim(),
        productName: document.getElementById("productName").value.trim(),
        category: document.getElementById("category").value,
        price: document.getElementById("price").value,
        sku: document.getElementById("sku").value.trim(),
        launchDate: document.getElementById("launchDate").value,
        imageUrl: document.getElementById("imageUrl").value.trim(),
        desc: document.getElementById("desc").value.trim(),
        contact: document.getElementById("contact").value.trim(),
        notes: document.getElementById("notes").value.trim(),
      };
      return data;
    }

    // ç°¡å–®é©—è­‰
    function validate(data) {
      const errors = [];
      if (!data.brandName) errors.push("å“ç‰Œåç¨±ç‚ºå¿…å¡«");
      if (!data.productName) errors.push("ç”¢å“åç¨±ç‚ºå¿…å¡«");
      if (!data.desc) errors.push("ç”¢å“æè¿°ç‚ºå¿…å¡«");
      return errors;
    }

    // é¡¯ç¤ºæˆåŠŸç•«é¢
    function showSuccess() {
      form.classList.add("hide");
      successView.classList.remove("hide");
    }
    function backToForm() {
      successView.classList.add("hide");
      form.classList.remove("hide");
    }

    resetBtn.addEventListener("click", () => form.reset());
    newEntryBtn.addEventListener("click", () => { form.reset(); backToForm(); });
    closeBtn.addEventListener("click", () => {
      if (liff.isInClient()) liff.closeWindow();
      else window.location.href = "https://line.me";
    });

    // ======= 2) LIFF åˆå§‹åŒ–èˆ‡ç™»å…¥æµç¨‹ =======
    async function initLiff() {
      try {
        liffStatus.textContent = "åˆå§‹åŒ– LIFF...";
        await liff.init({ liffId: LIFF_ID });
        liffStatus.textContent = "å·²åˆå§‹åŒ–";

        if (!liff.isLoggedIn()) {
          liffStatus.textContent = "å°šæœªç™»å…¥ï¼Œé‡æ–°å°å‘ç™»å…¥...";
          liff.login(); // æœƒé‡æ•´é é¢ä¸¦å›ä¾†
          return;
        }

        const profile = await liff.getProfile();
        displayNameEl.textContent = profile.displayName || "å·²ç™»å…¥";
        uidEl.textContent = profile.userId ? `userId: ${profile.userId}` : "";
        avatar.src = profile.pictureUrl || "";
        liffStatus.textContent = liff.isInClient() ? "åœ¨ LINE å…§é–‹å•Ÿ" : "åœ¨å¤–éƒ¨ç€è¦½å™¨é–‹å•Ÿ";
      } catch (err) {
        console.error(err);
        liffStatus.textContent = "LIFF åˆå§‹åŒ–å¤±æ•—";
        displayNameEl.textContent = "æœªç™»å…¥";
        uidEl.textContent = "";
      }
    }

    // ======= 3) é€å› LINE å°è©± =======
    sendToLineBtn.addEventListener("click", async () => {
      const payload = getFormData();
      const errs = validate(payload);
      if (errs.length) {
        alert("è«‹ä¿®æ­£ä»¥ä¸‹éŒ¯èª¤ï¼š\nâ€¢ " + errs.join("\nâ€¢ "));
        return;
      }

      const lines = [
        `ğŸ§¾ å“ç‰Œï¼ç”¢å“è³‡æ–™`,
        `å“ç‰Œï¼š${payload.brandName}`,
        payload.brandWebsite ? `å®˜ç¶²ï¼š${payload.brandWebsite}` : null,
        `ç”¢å“ï¼š${payload.productName}`,
        payload.category ? `åˆ†é¡ï¼š${payload.category}` : null,
        payload.price ? `å”®åƒ¹ï¼š${payload.price}` : null,
        payload.sku ? `SKUï¼š${payload.sku}` : null,
        payload.launchDate ? `ä¸Šå¸‚ï¼š${payload.launchDate}` : null,
        payload.imageUrl ? `ä¸»åœ–ï¼š${payload.imageUrl}` : null,
        `æè¿°ï¼š${payload.desc}`,
        payload.contact ? `è¯çµ¡ï¼š${payload.contact}` : null,
        payload.notes ? `å‚™è¨»ï¼š${payload.notes}` : null,
      ].filter(Boolean).join("\n");

      try {
        if (!liff.isLoggedIn()) {
          liff.login();
          return;
        }
        await liff.sendMessages([{ type: "text", text: lines }]);
        alert("å·²å‚³é€åˆ° LINE å°è©±ï¼");
        showSuccess();
      } catch (e) {
        console.error(e);
        alert("å‚³é€åˆ° LINE å¤±æ•—ï¼Œè«‹ç¢ºèªæ­¤ LIFF æ˜¯å¦æœ‰è¨Šæ¯æ¬Šé™ï¼ˆchat_message.writeï¼‰ã€‚");
      }
    });

    // ======= 4) POST åˆ° Webhookï¼ˆn8n ç­‰ï¼‰ =======
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const payload = getFormData();
      const errs = validate(payload);
      if (errs.length) {
        alert("è«‹ä¿®æ­£ä»¥ä¸‹éŒ¯èª¤ï¼š\nâ€¢ " + errs.join("\nâ€¢ "));
        return;
      }
      if (!WEBHOOK_URL) {
        alert("å°šæœªè¨­å®š Webhook URLï¼ˆç¨‹å¼ç¢¼æœ€ä¸Šæ–¹ WEBHOOK_URLï¼‰ã€‚");
        return;
      }

      // é™„å¸¶ LIFF åŸºæœ¬è³‡è¨Š
      try {
        const ctx = {
          lang: navigator.language,
          ts: new Date().toISOString(),
          liff: {
            inClient: liff.isInClient(),
            os: liff.getOS?.() || "",
            version: liff.getVersion?.() || "",
          }
        };
        let profile = null;
        try { profile = await liff.getProfile(); } catch {}
        const body = {
          type: "brand_product_form",
          profile,
          data: payload,
          context: ctx,
        };

        const res = await fetch(WEBHOOK_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body),
        });

        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        showSuccess();
      } catch (err) {
        console.error(err);
        alert("POST å¤±æ•—ï¼Œè«‹æª¢æŸ¥ Webhook CORS / ç¶²å€æ˜¯å¦æ­£ç¢ºã€‚");
      }
    });

    // å•Ÿå‹•
    initLiff();
  </script>
</body>
</html>

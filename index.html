<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>峰值體驗 - 專業顧問諮詢表單</title>
  <meta name="theme-color" content="#ffffff">
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    :root{
      --bg:#f7fafc; --card:#ffffff; --text:#0f172a; --muted:#64748b;
      --border:#e5e7eb; --accent:#3b82f6; --danger:#ef4444; --input:#ffffff;
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#ffffff 0%,#f7fafc 100%);
      color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial}
    .wrap{max-width:760px;margin:0 auto;padding:28px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:22px;box-shadow:0 10px 24px rgba(15,23,42,.06)}
    h1{margin:0 0 10px;font-size:22px}
    p.lead{margin:0 0 18px;color:var(--muted);font-size:14px}
    .topbar{display:flex;justify-content:space-between;align-items:flex-start;gap:16px;margin-bottom:8px}
    .topimg{width:64px;height:64px;border:1px solid var(--border);border-radius:12px;overflow:hidden;background:#fff;flex-shrink:0}
    .topimg img{width:100%;height:100%;object-fit:cover;display:block}
    .divider{height:1px;background:var(--border);margin:14px 0}
    label{font-size:13px;color:#475569;display:block;margin-bottom:12px}
    input,textarea,select{width:100%;background:var(--input);border:1px solid var(--border);color:var(--text);
      border-radius:12px;padding:12px 14px;font-size:14px;outline:none;transition:.2s border,.2s box-shadow}
    input:focus,textarea:focus,select:focus{border-color:#bfdbfe;box-shadow:0 0 0 3px rgba(59,130,246,.18)}
    textarea{min-height:140px;resize:vertical}
    .grid{display:grid;grid-template-columns:1fr;gap:20px}
    @media(min-width:720px){.grid-2{grid-template-columns:1fr 1fr}}
    .mt-20{margin-top:20px} /* 額外加大的垂直間距 */
    .btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:6px}
    button{border:0;border-radius:12px;padding:12px 16px;font-size:14px;cursor:pointer;background:#e2e8f0;color:#0f172a;transition:.15s transform,.2s background}
    button:active{transform:translateY(1px)}
    .primary{background:var(--accent);color:#fff}
    .danger{background:var(--danger);color:#fff}
    .footer{color:#94a3b8;font-size:12px;text-align:center;margin-top:18px}
    .hide{display:none !important} /* 確保送出前絕不顯示成功區塊 */
    .success-view{display:flex;flex-direction:column;align-items:center;gap:10px;text-align:center;padding:30px}
    .success-view h2{margin:0}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="topbar">
        <div>
          <h1>峰值體驗 - 專業顧問諮詢表單</h1>
          <p class="lead">您好我是專業顧問，接下來您可以跟我講一下你的品牌大致上的內容，以及您可能的商品介紹，我可以根據峰值體驗，協助您設計出MOT。</p>
        </div>
        <!-- 右上角圖片（由 TOP_RIGHT_IMAGE_URL 設定；若留空則不顯示） -->
        <div id="topImgBox" class="topimg hide"><img id="topImg" alt=""></div>
      </div>

      <div class="divider"></div>

      <form id="productForm" novalidate>
        <div class="grid grid-2">
          <div>
            <label for="brandName">公司名稱 <span style="color:#64748b">(必填)</span></label>
            <input id="brandName" name="brandName" placeholder="例：xxx 有限公司" required />
          </div>
          <div>
            <label for="brandWebsite">品牌官網 / 連結</label>
            <input id="brandWebsite" name="brandWebsite" placeholder="無 或 https://example.com" />
          </div>
        </div>

        <div class="grid">
          <div class="mt-20">
            <label for="productName">產品名稱 <span style="color:#64748b">(必填)</span></label>
            <input id="productName" name="productName" placeholder="例：五行守護香（木氣香）" required />
          </div>

          <div class="grid grid-2">
            <div>
              <label for="category">分類</label>
              <select id="category" name="category">
                <option value="">— 請選擇 —</option>
                <option>香氛 / 線香</option>
                <option>居家生活</option>
                <option>保健／食品</option>
                <option>美妝個清</option>
                <option>其他</option>
              </select>
            </div>
            <div>
              <label for="price">售價（數字）</label>
              <input id="price" name="price" type="number" inputmode="decimal" placeholder="2980" min="0" step="0.01" />
            </div>
          </div>

          <div>
            <label for="desc">產品描述 / 賣點</label>
            <textarea id="desc" name="desc" placeholder="可補充賣點、定位、目標客群等…（選填）"></textarea>
          </div>

          <div class="grid grid-2">
            <div>
              <label for="contact">聯絡 Email</label>
              <input id="contact" name="contact" type="email" placeholder="you@example.com" />
            </div>
            <div>
              <label for="phone">聯絡電話</label>
              <input id="phone" name="phone" type="tel" placeholder="09xx-xxx-xxx（選填）" />
            </div>
          </div>
        </div>

        <div class="divider"></div>
        <div class="btns">
          <button type="submit" class="primary" id="submitBtn">送出</button>
          <button type="button" class="danger" id="resetBtn">清除表單</button>
        </div>
      </form>

      <!-- 成功畫面：預設隱藏，送出成功後才顯示 -->
      <div id="successView" class="success-view hide">
        <h2>✅ 已提交完成！</h2>
        <p class="muted" id="countdownText">將在 5 秒後自動關閉...</p>
      </div>
    </div>

    <div class="footer">
      © <span id="year"></span> LIFF Form · 建議將此頁註冊為 LIFF Endpoint：<br/>
      <code>https://&lt;你的 GitHub 帳號&gt;.github.io/&lt;repo&gt;/index.html</code>
    </div>
  </div>

  <script>
    // ======= 基本設定：請替換 =======
    const LIFF_ID = "2008207008-8AzkQd0m";        // 必填：你的 LIFF ID
    const WEBHOOK_URL = "https://wooow.zeabur.app/webhook/gogo01";     // 必填：你的 n8n Webhook URL
    const TOP_RIGHT_IMAGE_URL = "https://www.tw-ren.com/sites/default/files/node/images/innovation/0113_%E6%9B%B8%E6%91%98BN_%E5%B3%B0%E5%80%BC%E9%AB%94%E9%A9%972.jpg";             // 可選：右上角圖片網址（留空則不顯示）
    // =================================

    const form = document.getElementById("productForm");
    const resetBtn = document.getElementById("resetBtn");
    const successView = document.getElementById("successView");
    const countdownText = document.getElementById("countdownText");
    const topImgBox = document.getElementById("topImgBox");
    const topImg = document.getElementById("topImg");

    // 年份
    document.getElementById("year").textContent = new Date().getFullYear();

    // 右上角圖片顯示控制
    if (TOP_RIGHT_IMAGE_URL && TOP_RIGHT_IMAGE_URL.trim() !== "") {
      topImg.src = TOP_RIGHT_IMAGE_URL.trim();
      topImgBox.classList.remove("hide");
    } else {
      topImgBox.classList.add("hide");
    }

    // 載入時確保成功畫面隱藏（雙重保險）
    successView.classList.add("hide");

    function getFormData() {
      return {
        brandName: document.getElementById("brandName").value.trim(), // 公司名稱
        brandWebsite: document.getElementById("brandWebsite").value.trim(), // 允許填「無」
        productName: document.getElementById("productName").value.trim(),
        category: document.getElementById("category").value,
        price: document.getElementById("price").value,
        desc: document.getElementById("desc").value.trim(),     // 非必填
        contact: document.getElementById("contact").value.trim(),
        phone: document.getElementById("phone").value.trim(),   // 非必填
      };
    }

    function validate(data) {
      const errors = [];
      if (!data.brandName) errors.push("公司名稱為必填");
      if (!data.productName) errors.push("產品名稱為必填");
      if (!WEBHOOK_URL) errors.push("尚未設定 Webhook URL");
      return errors;
    }

    function showSuccessAndAutoClose() {
      form.classList.add("hide");
      successView.classList.remove("hide");
      let seconds = 5;
      countdownText.textContent = `將在 ${seconds} 秒後自動關閉...`;
      const timer = setInterval(() => {
        seconds--;
        countdownText.textContent = `將在 ${seconds} 秒後自動關閉...`;
        if (seconds <= 0) {
          clearInterval(timer);
          if (window.liff && liff.isInClient()) liff.closeWindow();
          else window.location.href = "https://line.me";
        }
      }, 1000);
    }

    resetBtn.addEventListener("click", () => form.reset());

    // ======= LIFF 初始化（後端仍可取得 profile，但前端不顯示）=======
    async function initLiff() {
      try {
        await liff.init({ liffId: LIFF_ID });
        if (!liff.isLoggedIn()) { liff.login(); return; }
      } catch (err) {
        console.error("LIFF 初始化失敗", err);
      }
    }

    // ======= 只 POST 到 Webhook =======
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const payload = getFormData();
      const errs = validate(payload);
      if (errs.length) { alert("請修正以下錯誤：\n• " + errs.join("\n• ")); return; }

      try {
        let profile = null;
        try { profile = await liff.getProfile(); } catch {}
        const ctx = {
          lang: navigator.language,
          ts: new Date().toISOString(),
          liff: { inClient: liff.isInClient?.() || false, os: liff.getOS?.() || "", version: liff.getVersion?.() || "" }
        };
        const body = { type: "consult_form", profile, data: payload, context: ctx };

        const res = await fetch(WEBHOOK_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body),
        });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        showSuccessAndAutoClose();
      } catch (err) {
        console.error(err);
        alert("POST 失敗，請檢查 Webhook CORS / 網址是否正確。");
      }
    });

    initLiff();
  </script>
</body>
</html>
